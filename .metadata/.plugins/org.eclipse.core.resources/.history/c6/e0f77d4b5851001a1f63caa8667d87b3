package come.msa.service;

import java.util.Date;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.List;
import java.util.Map;

import org.springframework.core.ParameterizedTypeReference;
import org.springframework.http.HttpMethod;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Service;
import org.springframework.web.client.RestTemplate;

import come.msa.vo.PnShop;

@Service
public class GetPnshopListServiceImpl implements GetPnshopListService{
	
	@Override
	public ArrayList<PnShop> getPnshopList() {
		ArrayList<PnShop> pnshop_id_list = new ArrayList<>();
		
		RestTemplate restTemplate = new RestTemplate();
		String url_str = "http://127.0.0.1:8100/getpnshop";
		
		ResponseEntity<List<Map<String,String>>> response = 
				restTemplate.exchange(url_str, 
						HttpMethod.GET, null, new ParameterizedTypeReference<List<Map<String,String>>>() {
					
				});
		
//		ResponseEntity<String> response
//		  = restTemplate.getForEntity(url_str, String.class);
//				
//		String res_body = response.getBody();
		List<Map<String,String>> pnshop = response.getBody();
		for(int i=0; i<pnshop.size(); i++) {
			PnShop shop = new PnShop();
			shop.setPnshopid(pnshop.get(i).get("pnshopid"));
			shop.setPnshopName(pnshop.get(i).get("pnshopname"));	
			shop.setPnshop_strt_dts(pnshop.get(i).get("pnshopstr"));
			SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss.SSS"); 
			Date date = sdf.parse(pnshop.get(i).get("pnshopstr"));
			
			shop.setPnshop_end_dts(pnshop.get(i).get("pnshopend"));
			pnshop_id_list.add(shop);
		}

//		for(int i=1; i<=3; i++) {
//			PnShop shop = new PnShop();
//			shop.setPnshopid(String.valueOf(i));
//			shop.setPnshopName(String.valueOf(i)+"기획전");
//			pnshop_id_list.add(shop);
//		}
		return pnshop_id_list;	
	}

}
